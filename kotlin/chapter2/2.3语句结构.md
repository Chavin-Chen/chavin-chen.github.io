# 2.3 语句结构

Kotlin是面向表达式的语言，`if-else`和`when`既是控制语句也是表达式，而语句可以省略行尾分号`;`

## 分支结构
- `If-else`取代了三目运算符，返回对应分支语句块中最后的表达式值。
- `When`表达式，支持带参方式使用(增强版`Switch`)与无参方式使用。

```kotlin
val res:String = if (arg in 0 downTo -100 step 1) {
    println("negative")
    "negative" // 语句块中最后一条语句值即为分支值
} else if (arg in 0..100) {
    "positive"
} else {
    "zero"
}

// 无参分支链，通过布尔表达式匹配
when {
    null == s -> {
    }
    s.isEmpty() -> {
    }
    s.length > 9 -> {
        s = s.substring(0, 9)
    }
    else -> {
    }
}

// 有参结构，比对表达式和参数是否相等，或用于is、in表达式中
val res = when (val x: Any = Integer.parseInt("12")) {// 支持在条件表达式处使用声明变量
    0 -> "zero"
    1, 2 -> "a"
    Integer.parseInt("3") -> "b"
    is String -> "string"
    in 4..10 -> "c"
    else -> "other"
}
```

## 循环结构
- `For`循环用于可迭代类型(`Iterable<out T>`子类或拓展函数方式提供`Iterator<out T>`)，当对区间或数组遍历时会被优化而避免迭代器开销。
- `While`、`Do-While`循环语法同Java

```kotlin
for (item: Int in items) // 遍历迭代器对象
for (i in 1..9) // 遍历区间 [1, 9]
for (i in 1 until 9) // 遍历区间 [1, 9)
for (i in 9 downTo 1 step 2) // 或 for(i in 0 until 100 step 2)

// 基于索引遍历
val arr = arrayOf(1, 2, 3)
for (i in arr.indices) println(arr[i]) // 或 for((i,v) in arr.withIndex){}

while (i < 100) { ++i; }

do {
    val data = getData()
} while (null != data) // 块内局部遍历作用域拓展到此
```

## 返回与跳转
- `return`: 从最内层的函数或匿名函数(而不包含Lambda)返回。
- `break`/`continue`: 跳过/终止最内层的循环。

*注*：返回和跳转语句都是表达式，其值为Noting类型。

### 标签
Kotlin中任何表达式都可以用标签标记`label@`,跳转和返回语句支持添加标签:
- `break@label`/`continue@label` 跳转到标签标记循环位置，执行终止或跳过动作
- `return@label` 返回标签指定的函数或Lambda表达式(Lambda表达式具备隐式标签)

```kotlin
fun foo() {
    // Output: 1 * 1 = 1、3 * 1 = 3、3 * 2 = 6、3 * 3 = 9
    outer@ for (i in 0..3) {
        inner@ for (j in 0 until 4) {
            if (i * j == 0) continue@inner
            if (i * j == 4) continue@outer
            if (i * j == 6) break@outer
            println("$i * $j = ${i * j}")
        }
    }
    val res = run label@{
        listOf(1, 2, 3).forEach {
            // 默认的return会直接退出foo函数，添加标签限制的return可以从lambda表达式返回
            if (2 == it) return@forEach
            // 带标签限制的return语句支持返回值
            if (3 == it) return@label it
            println("forEach:$it")
        }
        println("in label")
    }
    println("after label $res")
}
```
